前端 Agents 代码规范与准则（Vue 3 · 2025）
0. 技术基线 & 目标
   栈：Vue 3.4+、TypeScript 5+、Vite 5+、Vue Router 4、Pinia 2、Axios、Vitest + @vue/test-utils、Playwright、ESLint v9（flat config）、Prettier、Stylelint（可选 Tailwind/UnoCSS）、Vue I18n、VueUse。
   硬性目标：
   pnpm lint / pnpm typecheck / pnpm test / pnpm e2e 全绿
   Lighthouse（或 Web Vitals）核心指标达标（LCP < 2.5s、CLS < 0.1、INP < 200ms）
   a11y 基线（可键盘全操作、表单关联、语义/ARIA 完整）
1. 目录结构 & 命名
   src/
   app/                 # 应用壳：App.vue、根布局、错误边界
   pages/               # 页面路由（约定式或显式 routes）
   components/          # 可复用组件（原子/通用）
   features/            # 业务功能模块（页面无关）
   entities/            # 领域实体（模型/DTO/类型）
   widgets/             # 复合组件（跨页面拼装）
   stores/              # Pinia stores（按领域分）
   composables/         # 复用逻辑（useXxx）
   services/            # API 客户端、适配器、缓存
   styles/              # 全局样式、CSS 变量、tailwind.css
   i18n/                # 语言包与 i18n 配置
   utils/               # 工具方法（纯函数）
   types/               # 全局类型声明
   tests/               # 测试配置与公共夹具
   命名：目录/文件 kebab-case，组件 PascalCase.vue，Composable useXxx.ts，Store useXxxStore.ts，类型 XxxDto / XxxModel。
2. 代码风格（SFC / TS / Imports）
   SFC：统一使用 <script setup lang="ts"> + <template> + <style scoped>；避免在模板中写复杂表达式，抽到 computed 或 useXxx。
   Props/Emits：使用 defineProps<T>() / defineEmits<E>()，必要时配合 zod/valibot 在 运行时 校验入口数据。
   Imports：路径使用 @/ 别名；同层导入优先相对路径；按 内置 → 第三方 → 别名 → 相对 分组，空行分隔。
   不可变数据：首选 const；避免在模板产生新引用（如 :class="{...obj}" 的对象字面量每次渲染都会新建）。
   副作用：放在 onMounted/onBeforeUnmount 或 watchEffect；避免在 setup 里无条件发请求。
3. 架构约束（状态/路由/API）
   3.1 状态（Pinia）
   每个领域一个 store，只存需要跨组件共享且有缓存价值的数据。
   Store 中：state 仅数据、getters 纯函数、actions 可含副作用（请求/缓存/重试）。
   // stores/useAuthStore.ts
   export const useAuthStore = defineStore('auth', {
   state: () => ({ token: '' as string, profile: null as UserProfile | null }),
   actions: {
   async login(payload: LoginDto) {
   const res = await api.auth.login(payload);
   this.token = res.token;
   this.profile = res.user;
   },
   logout() { this.$reset(); }
   }
   });
   3.2 路由（Vue Router）
   路由模块化 + 守卫集中：鉴权、权限、动态标题、埋点在 router/guards.ts。
   按需懒加载 () => import('...')；路由 meta 管理权限、缓存、布局。
   3.3 API 层（服务/适配器）
   单例 Axios 客户端 + 拦截器：请求注入 token，响应做统一错误归一化（网络/业务/权限）。
   DTO ↔ 领域模型用 adapter 转换，页面与模型解耦。
   // services/http.ts
   export const http = axios.create({ baseURL: import.meta.env.VITE_API_URL, timeout: 10000 });
   http.interceptors.request.use(cfg => {
   const token = useAuthStore().token;
   if (token) cfg.headers.Authorization = `Bearer ${token}`;
   return cfg;
   });
   http.interceptors.response.use(r => r, err => Promise.reject(normalizeHttpError(err)));
4. 可访问性（a11y）
   表单元素必须有 <label for> 或 aria-label；错误消息用 aria-live="polite"。
   交互控件（按钮、可点击卡片）使用 button/role="button"，可键盘操作（tabIndex、Enter/Space）。
   颜色对比遵循 WCAG AA（Contrast ≥ 4.5:1）；焦点样式 不可移除。
5. 性能与体验
   资源分割：路由级拆包 + 组件级懒加载；大列表用 virtual-scroller。
   图片：<img loading="lazy">、srcset/sizes；SVG 图标走 vite-svg-loader/unplugin-icons。
   计算与 Watch：避免深层 watch；用 computed 替代模板复杂逻辑；必要时 shallowRef/markRaw。
   缓存：API 读多写少用 stale-while-revalidate（可用 @tanstack/vue-query）。
   性能基线：首屏 < 2.5s，交互 < 200ms；慢接口日志化 + 重试/熔断策略。
6. 样式规范（Tailwind / UnoCSS / BEM）
   选择 Tailwind 或 UnoCSS，禁止内联 style；组件局部样式用 :deep() 谨慎透传。
   若用 SCSS：采用 BEM，禁止全局层级选择器；变量/主题用 CSS Vars（data-theme 切换）。
7. 测试策略（Vitest / Playwright）
   单元测试：组件用 @vue/test-utils + Vitest，覆盖核心交互与渲染（目标 ≥ 80% 行覆盖）。
   E2E：Playwright 覆盖关键用户旅程（登录、下单、支付）；断言视觉/网络/可访问性（axe）。
   契约测试：若后端提供 OpenAPI，生成 TS 类型，接口做 类型对齐（防止漂移）。
8. 代码检查与格式化（2025 Flat Config）
   ESLint（flat） + Prettier + TypeScript 严格模式：
   // eslint.config.mjs
   import js from '@eslint/js';
   import ts from 'typescript-eslint';
   import vue from 'eslint-plugin-vue';
   import prettier from 'eslint-config-prettier';

export default [
js.configs.recommended,
...ts.configs.strictTypeChecked,   // 严格 TS
...vue.configs['flat/essential'],  // Vue 3 推荐
{
languageOptions: { parserOptions: { project: './tsconfig.json', ecmaVersion: 'latest' } },
rules: {
'no-console': ['warn', { allow: ['warn', 'error'] }],
'no-undef': 'off',
'vue/block-order': ['error', { order: ['script', 'template', 'style'] }],
'vue/require-explicit-emits': 'error'
}
},
prettier
];
// tsconfig.json（关键片段）
{
"compilerOptions": {
"target": "ES2022",
"module": "ESNext",
"moduleResolution": "Bundler",
"strict": true,
"useDefineForClassFields": true,
"jsx": "preserve",
"types": ["vite/client"],
"paths": { "@/*": ["src/*"] }
}
}
// vite.config.ts（别名/插件）
import vue from '@vitejs/plugin-vue';
import Icons from 'unplugin-icons/vite';
import AutoImport from 'unplugin-auto-import/vite';
import Components from 'unplugin-vue-components/vite';
import { defineConfig } from 'vite';
import { FileSystemIconLoader } from 'unplugin-icons/loaders';

export default defineConfig({
plugins: [
vue(),
AutoImport({ imports: ['vue', 'vue-router', '@vueuse/core'], dts: 'src/auto-imports.d.ts' }),
Components({ dts: 'src/components.d.ts' }),
Icons({ customCollections: { app: FileSystemIconLoader('src/assets/icons') } })
],
resolve: { alias: { '@': '/src' } }
});
9. 组件示例（约束到位）
<!-- components/UserCard.vue -->
<script setup lang="ts">
import type { UserProfile } from '@/entities/user';
const props = defineProps<{
  user: UserProfile;
  clickable?: boolean;
}>();
const emit = defineEmits<{ click: [id: string] }>();

function onClick() {
  if (!props.clickable) return;
  emit('click', props.user.id);
}
</script>

<template>
  <article class="card focus:outline-none" :tabindex="clickable ? 0 : -1" @click="onClick" @keydown.enter="onClick">
    <img class="avatar" :src="user.avatarUrl" :alt="user.name" loading="lazy" />
    <div class="info">
      <h3>{{ user.name }}</h3>
      <p class="text-muted">{{ user.email }}</p>
    </div>
  </article>
</template>

<style scoped>
.card { display:flex; gap:.75rem; padding:.75rem; border-radius:12px; }
.avatar { width:40px; height:40px; border-radius:9999px; }
.text-muted { opacity:.7 }
</style>
10. 文档与可观测性
    所有组件/Composable 必须写 TSDoc 注释和最小使用示例。
    页级/重大交互埋点（exposure/click/submit）统一通过 services/analytics.ts 上报；错误统一走 services/logger.ts。
11. 提交与 CI 质量门禁
    提交信息：遵循 Conventional Commits（feat/fix/docs/refactor/test/chore/build）。
    预提交钩子（Husky + lint-staged）：
    {
    "lint-staged": {
    "*.{ts,tsx,vue}": ["eslint --fix", "prettier -w"],
    "*.{css,scss,pcss}": ["stylelint --fix", "prettier -w"],
    "*": "prettier -w"
    }
    }
    CI Pipeline（示例步骤）：
    pnpm i --frozen-lockfile
    pnpm lint && pnpm typecheck
    pnpm test --run（覆盖率阈值：语句/分支/函数/行 ≥ 80%）
    pnpm build
    pnpm e2e（冒烟）
12. Agent 执行清单（可直接下达）
    运行自动化格式化：prettier -w .。
    运行 ESLint（flat）并自动修复：eslint . --fix。
    运行 TypeScript 严格类型检查：vue-tsc --noEmit 或 tsc -p tsconfig.json --noEmit。
    单测：vitest --run --coverage；E2E：playwright test。
    Lighthouse 基线检查并产出报告。
    生成/更新组件故事：storybook build（如启用）。
    更新 README（运行、构建、环境变量、脚本解释、目录说明）。
    验收标准：上述命令全部成功；覆盖率阈值 & Lighthouse 指标达标；a11y 自动/人工检查通过；关键路径无阻塞。
13. 常见问题对策
    Props 与 emits 不匹配 → 启用 vue/require-explicit-emits、在 TS 中显式声明事件签名。
    深层响应式开销 → 使用 shallowRef/markRaw 存放大型不可变对象（如图表实例）。
    模板复杂度高 → 抽离到 useXxx 或子组件；模板表达式限制 1-2 层调用。
    国际化遗漏 → 开启 i18n extractor 脚本 & no-literal-string 自定义 ESLint 规则（在模板禁用中文硬编码）。
    网络错误分散 → 统一错误适配器；组件只消费标准错误结构。
